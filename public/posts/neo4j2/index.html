<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Real World Runs on Graphs!!üìà : Lets Make Users Social Again!! (Part 2) | Gokul Nair</title>
<meta name="keywords" content="Database, Spring boot, Graph">
<meta name="description" content="In this post, we‚Äôll implement core social media features such as allowing users to follow others, create posts, and interact with them through likes and comments. Additionally, we‚Äôll set up a vector-based document storage system, which will serve as the foundation for integrating Retrieval-Augmented Generation (RAG) capabilities into our application.">
<meta name="author" content="Me">
<link rel="canonical" href="//localhost:1313/posts/neo4j2/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css" integrity="sha256-IhHKMWS&#43;eDACT2qtKzouUghDpk&#43;PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as="style">
<link rel="icon" href="//localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="//localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="//localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="//localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="//localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="//localhost:1313/posts/neo4j2/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="//localhost:1313/" accesskey="h" title="Gokul Nair (Alt + H)">Gokul Nair</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="//localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="//localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Real World Runs on Graphs!!üìà : Lets Make Users Social Again!! (Part 2)
    </h1>
    <div class="post-description">
      In this post, we‚Äôll implement core social media features such as allowing users to follow others, create posts, and interact with them through likes and comments. Additionally, we‚Äôll set up a vector-based document storage system, which will serve as the foundation for integrating Retrieval-Augmented Generation (RAG) capabilities into our application.
    </div>
    <div class="post-meta"><span title='2025-06-28 11:30:03 +0000 +0000'>June 28, 2025</span>&nbsp;¬∑&nbsp;13 min&nbsp;¬∑&nbsp;Me

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#a-quick-rewind">A quick rewind!!</a></li>
    <li><a href="#lets-follow-">Lets follow!! ü§ù</a></li>
    <li><a href="#lets-create-some-posts">Lets create some posts!!ü§≥üéÜ</a>
      <ul>
        <li><a href="#cypher-basics">Cypher basics</a></li>
      </ul>
    </li>
    <li><a href="#lets-comments--and-likes-">Lets Comments üí¨ and likes üëç</a></li>
    <li><a href="#-creating-a-vector-document-store-for-rag">üîç Creating a Vector Document Store for RAG</a>
      <ul>
        <li><a href="#-what-is-rag-why-vectors">üß† What Is RAG? Why Vectors?</a></li>
        <li><a href="#-how-do-we-store-vectors">üì¶ How Do We Store Vectors?</a></li>
        <li><a href="#-setting-up-pinecone-index-environment-and-embedding-model">üîß Setting Up Pinecone: Index, Environment, and Embedding Model</a></li>
        <li><a href="#-choosing-the-right-embedding-model">üß¨ Choosing the Right Embedding Model</a></li>
        <li><a href="#-connecting-your-app">üåê Connecting Your App</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="a-quick-rewind">A quick rewind!!<a hidden class="anchor" aria-hidden="true" href="#a-quick-rewind">#</a></h2>
<p>In the previous post, we implemented user creation and successfully tested it via API endpoints. In this post, we‚Äôre taking things a step further by adding key features that make our application feel more like a real social network. Here‚Äôs what we‚Äôll explore:</p>
<ul>
<li>Enabling users to follow each other</li>
<li>Writing expressive queries using Cypher Query Language</li>
<li>Allowing users to create posts</li>
<li>Adding support for likes and comments on posts</li>
<li>Setting up a Vector Database for RAG (Retrieval-Augmented Generation)</li>
<li>Integrating Spring AI into the backend</li>
</ul>
<p>Let‚Äôs jump in and build out these social features step by step!</p>
<h2 id="lets-follow-">Lets follow!! ü§ù<a hidden class="anchor" aria-hidden="true" href="#lets-follow-">#</a></h2>
<p>To implement the follow functionality, we‚Äôll send a request to the backend containing the <em>follower ID</em> and the <em>followee ID</em>. The backend will then fetch both users from the database (if they exist) and establish a <em><strong>FOLLOWS</strong></em> relationship by adding the <strong>followee to the following list of the follower</strong>.</p>
<p>In the previous post, we already created the <strong>AppUser</strong> class, which includes a list to track followed users, as shown below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Node</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Id</span> <span style="color:#a6e22e">@GeneratedValue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Long id;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String name;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Relationship</span>(type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;FOLLOWS&#34;</span>, direction <span style="color:#f92672">=</span> Relationship.<span style="color:#a6e22e">Direction</span>.<span style="color:#a6e22e">OUTGOING</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> following <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>However, this list is currently not being populated with any relationships. To enable that, we‚Äôll implement the necessary logic inside the UserService class. This logic will handle the follow action by accepting the follower and followee IDs, and it will be triggered via the corresponding controller endpoint.</p>
<p>So lets impement the new POST endpoint in the UserController:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/{followerId}/follow/{followeeId}&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>AppUser<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">follow</span>(<span style="color:#a6e22e">@PathVariable</span> Long followerId, <span style="color:#a6e22e">@PathVariable</span> Long followeeId) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> userService.<span style="color:#a6e22e">followUser</span>(followerId, followeeId);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>So this returns a <code>Mono&lt;AppUser&gt;</code>, which will be the updated follower user instance containing the newly added followee in their following list. Since we‚Äôre working with a reactive stack, the result is wrapped in a <code>Mono</code>, representing an asynchronous, non-blocking operation that will emit the updated user once the follow relationship is successfully created.</p>
<p>Now we will add the business logic in the <code>UserService</code> class.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>AppUser<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">followUser</span>(Long followerId, Long followeeId) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> userRepository.<span style="color:#a6e22e">findById</span>(followerId)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">zipWith</span>(userRepository.<span style="color:#a6e22e">findById</span>(followeeId))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">flatMap</span>(tuple <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>                    AppUser follower <span style="color:#f92672">=</span> tuple.<span style="color:#a6e22e">getT1</span>();
</span></span><span style="display:flex;"><span>                    AppUser followee <span style="color:#f92672">=</span> tuple.<span style="color:#a6e22e">getT2</span>();
</span></span><span style="display:flex;"><span>                    follower.<span style="color:#a6e22e">getFollowing</span>().<span style="color:#a6e22e">add</span>(followee);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> userRepository.<span style="color:#a6e22e">save</span>(follower);
</span></span><span style="display:flex;"><span>                });
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>So, what‚Äôs happening here?</p>
<p>At first glance, this may look complex, but it‚Äôs actually a straightforward reactive operation:</p>
<ul>
<li>We first retrieve both the follower and the followee from the database using their IDs.</li>
<li>The zipWith operator combines the two <code>Mono&lt;AppUser&gt;</code> streams into one, emitting a tuple of both users once they‚Äôre fetched.</li>
<li>Inside the flatMap, we extract both users from the tuple.</li>
<li>We then add the followee to the following list of the follower.</li>
<li>Finally, we save the updated follower back to the database with the new relationship.</li>
</ul>
<p>Don‚Äôt be intimidated by flatMap‚Äîin this case, it‚Äôs simply used to perform a transformation and chaining of asynchronous operations after fetching the two users. Think of it as a way to handle the result once both users are available.</p>
<p>This method returns a Mono<!-- raw HTML omitted -->, representing the updated follower, now with the new followee included in their following list. Since we‚Äôre in a reactive context (thanks to Spring WebFlux and Neo4j Reactive Support), the return type is asynchronous and non-blocking.</p>
<p><strong>That wraps up our user-following implementation. Now, let‚Äôs move on to how users can create a post.</strong></p>
<h2 id="lets-create-some-posts">Lets create some posts!!ü§≥üéÜ<a hidden class="anchor" aria-hidden="true" href="#lets-create-some-posts">#</a></h2>
<p><strong>Now that we‚Äôve implemented user creation and following functionality, it‚Äôs time to allow users to create posts ‚Äî a core part of any social media experience.</strong></p>
<p>We‚Äôll follow a simple yet clean architecture. When a user creates a post, they hit the endpoint:
<code>POST http://localhost:8080/posts/{userId}</code></p>
<p>with a request body that looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;title&#34;</span>: <span style="color:#e6db74">&#34;My First Post&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;content&#34;</span>: <span style="color:#e6db74">&#34;Hello World from Instagrat!&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Let‚Äôs walk through how this works in code.</p>
<p>üì® DTO</p>
<p>We use a record in Java to model the incoming post data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">record</span> <span style="color:#a6e22e">PostDto</span>(String title,String content){
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Records are great for immutable data structures. Here, <code>PostDto</code> is simple and clean ‚Äî it just carries the post‚Äôs title and content from the frontend to the backend.</p>
<p>üì¨ Controller</p>
<p>We expose an endpoint in our <code>PostController</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/posts&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PostController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> PostService postService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/{userId}&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Post<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createPost</span>(<span style="color:#a6e22e">@PathVariable</span> Long userId, <span style="color:#a6e22e">@RequestBody</span> PostDto postDto){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> postService.<span style="color:#a6e22e">createPost</span>(postDto,userId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here:</p>
<ul>
<li>We use <code>@PostMapping(&quot;/{userId}&quot;)</code> to associate a post with the user who created it.</li>
<li>We return a <code>Mono&lt;Post&gt;</code> ‚Äî which is part of Project Reactor and represents an asynchronous operation that will eventually emit a single post (or nothing).</li>
</ul>
<p>üß† Business Logic (Service Layer)</p>
<p>we implement as below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PostService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> PostRepository postRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>Post<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createPost</span>(PostDto postDto, Long userId) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Post post<span style="color:#f92672">=</span>Post.<span style="color:#a6e22e">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">title</span>(postDto.<span style="color:#a6e22e">title</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">content</span>(postDto.<span style="color:#a6e22e">content</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">createdAt</span>(LocalDateTime.<span style="color:#a6e22e">now</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> postRepository.<span style="color:#a6e22e">save</span>(post)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">flatMap</span>(savedPost<span style="color:#f92672">-&gt;</span>{
</span></span><span style="display:flex;"><span>                    savedPost.<span style="color:#a6e22e">setPostId</span>(savedPost.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> postRepository.<span style="color:#a6e22e">save</span>(savedPost);
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">doOnNext</span>(saved <span style="color:#f92672">-&gt;</span> System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;‚úÖ Post saved: &#34;</span> <span style="color:#f92672">+</span> saved.<span style="color:#a6e22e">getId</span>()))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">flatMap</span>(savedPost <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>                        postRepository.<span style="color:#a6e22e">createUserPostRelation</span>(savedPost.<span style="color:#a6e22e">getPostId</span>(), userId)
</span></span><span style="display:flex;"><span>                                .<span style="color:#a6e22e">then</span>(Mono.<span style="color:#a6e22e">fromRunnable</span>(() <span style="color:#f92672">-&gt;</span> System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;‚úÖ Relation created&#34;</span>)))
</span></span><span style="display:flex;"><span>                                .<span style="color:#a6e22e">thenReturn</span>(savedPost)
</span></span><span style="display:flex;"><span>                );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>First, we build a Post entity and save it using postRepository.save().</p>
<ul>
<li>Neo4j auto-generates the internal ID, so we update postId after the first save.</li>
<li>We create a relationship between the <code>AppUser</code> (who made the post) and the <code>Post</code> via a method in the repository.</li>
<li>Finally, we return the saved <code>Post</code>.</li>
</ul>
<p>üóÉÔ∏è Repository Layer</p>
<p>Creating Relationships in Neo4j using <code>Cypher</code>
Here‚Äôs where things get interesting: relationships in Neo4j.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">PostRepository</span> <span style="color:#66d9ef">extends</span> ReactiveNeo4jRepository<span style="color:#f92672">&lt;</span>Post,Long<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Query</span>(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            MATCH (user:AppUser {userId: $userId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            MATCH (post:Post {postId: $postId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            MERGE (user)-[relationship:CREATED_POST]-&gt;(post)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ON CREATE SET 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            relationship.createdAt = localdatetime(),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            relationship.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            ON MATCH SET
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            relationship.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createUserPostRelation</span>(<span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;postId&#34;</span>) Long postId, <span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;userId&#34;</span>) Long userId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="cypher-basics">Cypher basics<a hidden class="anchor" aria-hidden="true" href="#cypher-basics">#</a></h3>
<p><strong>What‚Äôs Going on in the Cypher Query?</strong></p>
<p>Cypher is Neo4j‚Äôs query language ‚Äî similar to SQL but for graph databases.</p>
<pre tabindex="0"><code class="language-cypher" data-lang="cypher">MATCH (user:AppUser {userId: $userId})
</code></pre><ul>
<li>Find a user node with the given userId.</li>
</ul>
<pre tabindex="0"><code class="language-cypher" data-lang="cypher">MATCH (post:Post {postId: $postId})
</code></pre><ul>
<li>Find a post node with the given postId.</li>
</ul>
<pre tabindex="0"><code class="language-cypher" data-lang="cypher">MERGE (user)-[relationship:CREATED_POST]-&gt;(post)
</code></pre><ul>
<li>If the relationship CREATED_POST doesn‚Äôt exist between this user and post, create it.</li>
<li>If it already exists, reuse it.</li>
<li>MERGE is like a combination of MATCH + CREATE ‚Äî ensuring uniqueness.</li>
</ul>
<pre tabindex="0"><code class="language-cypher" data-lang="cypher">ON CREATE SET relationship.createdAt = localdatetime(), relationship.updatedAt = localdatetime()
</code></pre><ul>
<li>Set timestamps when this relationship is created.</li>
</ul>
<pre tabindex="0"><code class="language-cypher" data-lang="cypher">ON MATCH SET relationship.updatedAt = localdatetime()
</code></pre><ul>
<li>If the relationship already existed, just update the updatedAt timestamp.</li>
</ul>
<p>Let‚Äôs fire a quick request to our endpoint and see if everything works:</p>
<pre tabindex="0"><code class="language-curl" data-lang="curl">‚ï∞‚îÄ curl -X POST http://localhost:8080/posts/3 
  -H &#34;Content-Type: application/json&#34; \
  -d &#39;{
        &#34;title&#34;: &#34;My First Post&#34;,
        &#34;content&#34;: &#34;Excited to start using this app!&#34;
      }&#39;
{&#34;id&#34;:8,&#34;postId&#34;:8,&#34;title&#34;:&#34;My First Post&#34;,&#34;content&#34;:&#34;Excited to start using this app!&#34;,&#34;createdAt&#34;:&#34;2025-07-13T17:28:18.12533&#34;}%
</code></pre><p>üéâ Boom! We‚Äôve successfully created a post, and we even get back the post with a timestamp. Our backend is behaving exactly as expected ‚Äî post creation and the user relationship are working perfectly!</p>
<h2 id="lets-comments--and-likes-">Lets Comments üí¨ and likes üëç<a hidden class="anchor" aria-hidden="true" href="#lets-comments--and-likes-">#</a></h2>
<p>Just like how we implemented post creation earlier, we‚Äôll follow a simple and consistent architecture for enabling users to comment on posts. The flow is straightforward:</p>
<ul>
<li>The client sends a POST request with the comment content.</li>
<li>We create a Comment entity from the DTO.</li>
<li>Save it to the database.</li>
<li>Create relationships:
<ul>
<li>Between the user and the comment (CREATED_COMMENT)</li>
<li>Between the post and the comment (HAS_COMMENT)</li>
</ul>
</li>
</ul>
<p>üì¨ Controller</p>
<p>Let‚Äôs begin with the REST endpoint <code>http://localhost:8080/comments/{userId}/comment/{postId}</code> that handles incoming comment requests:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/comments&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CommentController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> CommentService commentService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;{userId}/comment/{postId}&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Comment<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createComment</span>(<span style="color:#a6e22e">@RequestBody</span> CommentDto commentDto, <span style="color:#a6e22e">@PathVariable</span> Long userId, <span style="color:#a6e22e">@PathVariable</span> Long postId){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> commentService.<span style="color:#a6e22e">createComment</span>(commentDto,userId,postId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>üì® DTO</p>
<p>Here‚Äôs the CommentDto we send from the frontend:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">record</span> <span style="color:#a6e22e">CommentDto</span>(String comment) {
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>üß† Business Logic (Service Layer)</p>
<p>Now the real work happens inside the CommentService:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CommentService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> CommentRepository commentRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>Comment<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createComment</span>(CommentDto commentDto, Long userId, Long postId) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Comment comment <span style="color:#f92672">=</span>Comment.<span style="color:#a6e22e">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">comment</span>(commentDto.<span style="color:#a6e22e">comment</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">createdAt</span>(LocalDateTime.<span style="color:#a6e22e">now</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> commentRepository.<span style="color:#a6e22e">save</span>(comment)
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">flatMap</span>(savedComment<span style="color:#f92672">-&gt;</span>{
</span></span><span style="display:flex;"><span>                    savedComment.<span style="color:#a6e22e">setCommentId</span>(savedComment.<span style="color:#a6e22e">getId</span>());
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> commentRepository.<span style="color:#a6e22e">save</span>(savedComment);
</span></span><span style="display:flex;"><span>                })
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">doOnNext</span>(comment1 <span style="color:#f92672">-&gt;</span> System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;The comment saved again with id&#34;</span><span style="color:#f92672">+</span>comment1.<span style="color:#a6e22e">getCommentId</span>()))
</span></span><span style="display:flex;"><span>                .<span style="color:#a6e22e">flatMap</span>(comment1 <span style="color:#f92672">-&gt;</span>
</span></span><span style="display:flex;"><span>                    commentRepository.<span style="color:#a6e22e">createUserCommentRelation</span>(comment1.<span style="color:#a6e22e">getCommentId</span>(),userId)
</span></span><span style="display:flex;"><span>                                    .<span style="color:#a6e22e">then</span>(commentRepository.<span style="color:#a6e22e">createPostCommentRelation</span>(postId,comment1.<span style="color:#a6e22e">getCommentId</span>()))
</span></span><span style="display:flex;"><span>                            .<span style="color:#a6e22e">thenReturn</span>(comment1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                );
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>‚ö†Ô∏è Why are we saving twice?</p>
<p>You might wonder why we save the comment twice:</p>
<ul>
<li>The first save creates a node in the Neo4j database and assigns it a database-generated ID (id).</li>
<li>We then assign this id as commentId, which is our custom identifier used in Cypher queries.</li>
<li>Finally, we save again to persist this commentId.</li>
</ul>
<p>This might seem redundant, but it‚Äôs necessary when using both internal Neo4j IDs and custom fields for querying or relationships.</p>
<p>üóÉÔ∏è Repository Layer</p>
<p>We use Cypher <code>MERGE</code> to create or update the relationships, just like we did earlier for posts.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">CommentRepository</span> <span style="color:#66d9ef">extends</span> ReactiveNeo4jRepository<span style="color:#f92672">&lt;</span>Comment,Long<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Query</span>(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MATCH (user:AppUser {userId: $userId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MATCH (comment:Comment {commentId: $commentId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MERGE (user)-[relationship:CREATED_COMMENT]-&gt;(comment)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ON CREATE SET 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        relationship.createdAt = localdatetime(),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        relationship.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ON MATCH SET
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        relationship.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createUserCommentRelation</span>(<span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;commentId&#34;</span>) Long commentId, <span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;userId&#34;</span>) Long userId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Query</span>(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MATCH (post:Post {postId: $postId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MATCH (comment:Comment {commentId: $commentId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    MERGE (post)-[relationship:HAS_COMMENT]-&gt;(comment)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ON CREATE SET 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        relationship.createdAt = localdatetime(),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        relationship.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    ON MATCH SET
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        relationship.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">createPostCommentRelation</span>(<span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;postId&#34;</span>) Long postId, <span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;commentId&#34;</span>) Long commentId);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>‚úÖ Testing It</p>
<p>Let‚Äôs test this using curl for a user with ID <code>5</code> commenting on a post with ID <code>6</code>:</p>
<pre tabindex="0"><code class="language-curl" data-lang="curl"> curl -X POST http://localhost:8080/comments/5/comment/6 \                                                                                                                                                                                                                                                               ‚îÄ‚ïØ
  -H &#34;Content-Type: application/json&#34; \
  -d &#39;{
        &#34;comment&#34;: &#34;This post is really helpful. Thanks!&#34;
      }&#39;
{&#34;id&#34;:9,&#34;commentId&#34;:9,&#34;comment&#34;:&#34;This post is really helpful. Thanks!&#34;,&#34;createdAt&#34;:&#34;2025-07-13T18:30:41.960012&#34;}%
</code></pre><p>üí¨ Boom! The comment was saved and linked correctly to both the user and the post.</p>
<p>For liking a post, we take a simpler but very practical route:
We don‚Äôt need any extra information apart from the user and post IDs. So, no DTO is necessary.</p>
<p>Instead, we directly form a relationship in the database between the user who liked and the post that was liked.</p>
<p>üìç Endpoint Structure</p>
<p>The endpoint for liking a post looks like this:</p>
<pre tabindex="0"><code class="language-curl" data-lang="curl">POST http://localhost:8080/likes/{userId}/like/{postId}
</code></pre><p>This clearly conveys the action:
User {userId} likes Post {postId}.</p>
<p>üîß Controller</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@RestController</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequestMapping</span>(<span style="color:#e6db74">&#34;/likes&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PostLikeController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> LikeService likeService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/{userId}/like/{postId}&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">likePost</span>(<span style="color:#a6e22e">@PathVariable</span> Long userId,<span style="color:#a6e22e">@PathVariable</span> Long postId){
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> likeService.<span style="color:#a6e22e">likePost</span>(userId,postId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Explanation:</p>
<ul>
<li>We return <code>Mono&lt;Void&gt;</code> here because we‚Äôre not returning any specific data after the like operation.
<ul>
<li>In WebFlux, returning Mono<!-- raw HTML omitted --> means:</li>
<li>‚ÄúI‚Äôm not returning a body, just letting you know the operation is asynchronous and will complete successfully or with an error.‚Äù</li>
<li>It‚Äôs especially suitable for:
<ul>
<li>Creating relationships</li>
<li>Logging actions</li>
<li>Sending fire-and-forget events</li>
</ul>
</li>
</ul>
</li>
<li>The main purpose is just to perform the action (i.e., create a relationship) and let the caller know it succeeded (implicitly via <code>HTTP 200 OK</code> or <code>204 No Content</code>).</li>
</ul>
<p>üíº Service Layer</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LikeService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> LikeRepository likeRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">likePost</span>(Long userId, Long postId) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> likeRepository.<span style="color:#a6e22e">likePost</span>(userId,postId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>üß† Repository (Cypher Query)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">LikeRepository</span> <span style="color:#66d9ef">extends</span> ReactiveNeo4jRepository<span style="color:#f92672">&lt;</span>Post,Long<span style="color:#f92672">&gt;</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Query</span>(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        MATCH (user:AppUser {userId: $userId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        MATCH (post:Post {postId: $postId})
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        MERGE (user)-[like:LIKES]-&gt;(post)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ON CREATE SET 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            like.createdAt = localdatetime(),
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            like.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ON MATCH SET
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            like.updatedAt = localdatetime()
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    Mono<span style="color:#f92672">&lt;</span>Void<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">likePost</span>(<span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;userId&#34;</span>) Long userId, <span style="color:#a6e22e">@Param</span>(<span style="color:#e6db74">&#34;postId&#34;</span>) Long postId);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>üß™ Let‚Äôs Test it</p>
<p>Use this curl command to test the endpoint:</p>
<pre tabindex="0"><code class="language-curl" data-lang="curl">curl -X POST http://localhost:8080/likes/5/like/6
</code></pre><p>Here:</p>
<ul>
<li>5 is the user ID (e.g., JohnDoe)</li>
<li>6 is the post ID (e.g., ‚ÄúLearn AI with Spring‚Äù)</li>
</ul>
<p>Since the response is <code>Mono&lt;Void&gt;</code>, you won‚Äôt see a response body ‚Äî that‚Äôs expected.</p>
<p>üëÄ View in Neo4j Browser</p>
<p>To verify the like operation visually, head over to: <code>http://localhost:7474/browser/preview/</code>
There, you‚Äôll see a new relationship and also all the previous relations we created:</p>
<p>The UI is very intuitive and you can double click on expanding the nodes and relations.</p>
<p><a href="https://postimg.cc/WtK0ssJm"><img alt="Screenshot-2025-07-13-at-19-13-34.png" loading="lazy" src="https://i.postimg.cc/NfGD7Msn/Screenshot-2025-07-13-at-19-13-34.png"></a></p>
<p>‚úÖ And that‚Äôs it! We‚Äôve implemented all the core functionalities we set out to build.</p>
<p>Now it‚Äôs your turn ‚Äî try adding more data to the database using the available endpoints.
Remember, the more data, the more fun it gets ‚Äî especially when AI comes into play later. More data means better insights, smarter recommendations, and richer social interactions.</p>
<h2 id="-creating-a-vector-document-store-for-rag">üîç Creating a Vector Document Store for RAG<a hidden class="anchor" aria-hidden="true" href="#-creating-a-vector-document-store-for-rag">#</a></h2>
<p>To unlock AI-powered features‚Äîlike smart recommendations, semantic search, or contextual chat‚Äîwe need a way for our app to <strong>retrieve relevant content</strong> efficiently. This is where <strong>Retrieval-Augmented Generation (RAG)</strong> comes in.</p>
<h3 id="-what-is-rag-why-vectors">üß† What Is RAG? Why Vectors?<a hidden class="anchor" aria-hidden="true" href="#-what-is-rag-why-vectors">#</a></h3>
<p><strong>RAG</strong> combines large language models (LLMs) with external knowledge sources. Instead of relying only on the model‚Äôs built-in knowledge, RAG retrieves up-to-date, domain-specific information (posts, comments, docs) and uses it to generate more accurate responses.</p>
<ul>
<li><strong>Traditional search:</strong> Relies on keywords.</li>
<li><strong>Vector search:</strong> Finds semantically similar text‚Äîsearching by meaning, not just words!</li>
</ul>
<p>This works by converting documents into <strong>high-dimensional vectors (embeddings)</strong>. At query time, we use similarity search to find the most relevant content.</p>
<blockquote>
<p><strong>Example:</strong> Searching for ‚ÄúHow to build a graph database?‚Äù will return posts about Neo4j, Cypher, and Spring Data‚Äîeven if those exact words aren‚Äôt used.</p></blockquote>
<hr>
<h3 id="-how-do-we-store-vectors">üì¶ How Do We Store Vectors?<a hidden class="anchor" aria-hidden="true" href="#-how-do-we-store-vectors">#</a></h3>
<p>We need a <strong>Vector Store</strong>‚Äîa database optimized for storing and querying embeddings.</p>
<h4 id="-cloud-option-pinecone">‚òÅÔ∏è Cloud Option: Pinecone<a hidden class="anchor" aria-hidden="true" href="#-cloud-option-pinecone">#</a></h4>
<p><a href="https://www.pinecone.io/">Pinecone</a> is a fully managed, serverless vector database. It‚Äôs ideal for modern AI apps because:</p>
<ul>
<li><strong>Scalable &amp; fast:</strong> Handles millions of vectors with low latency.</li>
<li><strong>Easy integration:</strong> Works with OpenAI, LangChain, and LLMs.</li>
<li><strong>Real-time updates:</strong> Supports filtering and hybrid search.</li>
<li><strong>Free tier:</strong> Great for experimentation.</li>
</ul>
<p>We‚Äôll use Pinecone to store vector embeddings for our posts, comments, or user bios‚Äîpowering semantic search and AI features.</p>
<h4 id="-localself-hosted-alternatives">üíª Local/Self-Hosted Alternatives<a hidden class="anchor" aria-hidden="true" href="#-localself-hosted-alternatives">#</a></h4>
<p>Prefer running locally? Try these open-source options:</p>
<table>
  <thead>
      <tr>
          <th>Tool</th>
          <th>Highlights</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>FAISS</strong></td>
          <td>Facebook AI Similarity Search‚Äîlightweight, fast, perfect for local dev/testing.</td>
      </tr>
      <tr>
          <td><strong>Chroma</strong></td>
          <td>Simple, open-source, built for RAG and LLM pipelines.</td>
      </tr>
      <tr>
          <td><strong>Weaviate</strong></td>
          <td>Scalable engine with GraphQL-like queries, hybrid search, and metadata filtering.</td>
      </tr>
      <tr>
          <td><strong>Qdrant</strong></td>
          <td>Rust-based, high-performance, supports advanced filtering‚Äîgreat for production.</td>
      </tr>
  </tbody>
</table>
<p>All of these work well with <a href="https://www.langchain.com/">LangChain</a>, <a href="https://haystack.deepset.ai/">Haystack</a>, and other LLM frameworks. Most can be spun up quickly via Docker.</p>
<h3 id="-setting-up-pinecone-index-environment-and-embedding-model">üîß Setting Up Pinecone: Index, Environment, and Embedding Model<a hidden class="anchor" aria-hidden="true" href="#-setting-up-pinecone-index-environment-and-embedding-model">#</a></h3>
<p>After signing up for Pinecone, you‚Äôll create a new <strong>index</strong>‚Äîyour vector storage container.</p>
<p><strong>Configuration options:</strong></p>
<ul>
<li><strong>Index Name:</strong> For example, <code>springai</code></li>
<li><strong>Metric:</strong> Use <strong>cosine distance</strong> (ideal for semantic similarity)</li>
<li><strong>Dimension:</strong> Set according to your embedding model (see below)</li>
<li><strong>Pods:</strong> Default is fine for prototyping</li>
</ul>
<hr>
<h3 id="-choosing-the-right-embedding-model">üß¨ Choosing the Right Embedding Model<a hidden class="anchor" aria-hidden="true" href="#-choosing-the-right-embedding-model">#</a></h3>
<p>When integrating Pinecone with OpenAI, selecting the right embedding model is crucial. OpenAI now recommends <code>text-embedding-3-small</code>:</p>
<ul>
<li><strong>Smaller &amp; faster:</strong> Lower cost, quicker responses</li>
<li><strong>High performance:</strong> Excellent semantic search</li>
<li><strong>Vector dimension:</strong> Returns vectors of size <strong>1536</strong></li>
</ul>
<p><strong>Tip:</strong><br>
When creating your Pinecone index, set <code>dimension = 1536</code> to match the output of <code>text-embedding-3-small</code>.</p>
<hr>
<h3 id="-connecting-your-app">üåê Connecting Your App<a hidden class="anchor" aria-hidden="true" href="#-connecting-your-app">#</a></h3>
<p>Your Pinecone <strong>host URL</strong> (e.g., <code>https://&lt;your-index&gt;.svc.&lt;region&gt;.pinecone.io</code>) contains your environment and project details.<br>
<strong>Keep your API keys and host URLs private‚Äînever share them publicly.</strong></p>
<p>You‚Äôll use these credentials to initialize Pinecone clients in your backend application.</p>
<p>Once compleated creating index, you will have something like this:</p>
<p><a href="https://postimg.cc/xJQNXd3h"><img alt="Screenshot-2025-07-13-at-19-42-13.png" loading="lazy" src="https://i.postimg.cc/4d76F77f/Screenshot-2025-07-13-at-19-42-13.png"></a></p>
<h2 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h2>
<p>üö¶ Wrapping Up (Finally üòÖ)</p>
<p>Whew! If you‚Äôve made it this far ‚Äî hats off üß¢ to you. This post is already clocking in at over 10+ minutes of reading, and we‚Äôve covered a lot:</p>
<ul>
<li>Built a basic social media backend with Neo4j and Spring WebFlux</li>
<li>Implemented core features like post creation, comments, and likes</li>
<li>Connected the dots for vector storage using Pinecone and OpenAI embeddings</li>
</ul>
<p>I initially planned to introduce <a href="https://spring.io/projects/spring-ai">Spring AI</a> here too‚Ä¶ but that would turn this post into a mini eBook! So, let‚Äôs hit pause for now and leave that for the next chapter. If you‚Äôre curious, check out the <a href="https://docs.spring.io/spring-ai/reference/">Spring AI documentation</a> for a sneak peek at what‚Äôs coming next.</p>
<p>üöÄ What‚Äôs Next?</p>
<p>In the next post, we‚Äôll roll up our sleeves and build our own ‚Äúpoor man‚Äôs GROK‚Äù‚Äî we  will name it <strong>BROK</strong> üòÑ.</p>
<p><strong>BROK</strong> will be your social smart assistant, designed to:</p>
<ul>
<li>üß† Contextually surface posts from people you follow ‚Äì not just by date, but by meaning and relevance</li>
<li>üîç Leverage our Pinecone-backed vector database to perform semantic, AI-powered searches over content</li>
<li>üß± Establish the foundation for RAG-driven social intelligence ‚Äì where retrieval meets generation</li>
<li>üí¨ Enable smart Q&amp;A based on your network‚Äôs activity ‚Äì let the bot answer what your friends are talking about</li>
</ul>
<hr>
<p>Thanks for following along! üöÄ<br>
Keep experimenting, building, and sharing your progress. So, I‚Äôll wrap up this blog here. We‚Äôve covered quite a bit today! You can find all the code for this part here üëâ <a href="https://github.com/gokintosh/InstaGrat/tree/rag-data-seeding"><strong>github</strong></a>.</p>
<p>The next part of this series will be available as soon as it‚Äôs ready. Stay tuned ‚Äî it‚Äôs coming soon!</p>
<hr>
<p><img alt="Geek Celebration GIF" loading="lazy" src="https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif"></p>
<p>Happy coding! üßë‚Äçüíª‚ú®</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="//localhost:1313/tags/database/">Database</a></li>
      <li><a href="//localhost:1313/tags/spring-boot/">Spring Boot</a></li>
      <li><a href="//localhost:1313/tags/graph/">Graph</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="//localhost:1313/posts/neo4j/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Real World Runs on Graphs!!üìà : A Hands-On Intro to Neo4j (Part 1)</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="//localhost:1313/">Gokul Nair</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
